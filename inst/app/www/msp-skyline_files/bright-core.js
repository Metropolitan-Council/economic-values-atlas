var $j=jQuery;function popupViewAgreement(a_lAgreementId){mywindow=open("../action/viewAgreement?id="+a_lAgreementId,"viewAgreement","resizable=yes,scrollbars=yes,toolbar=no,width=500,height=500");mywindow.focus();if(mywindow.opener==null){mywindow.opener=self}}function popupEditAgreement(a_lAgreementId){mywindow=open("../action/editAgreementPopup?copy=1&id="+a_lAgreementId,"viewAgreement","resizable=yes,scrollbars=no,toolbar=no,width=800,height=600");mywindow.focus();if(mywindow.opener==null){mywindow.opener=self}}function popupViewImage(a_lImageId){mywindow=open("../action/viewFullSizedImage?id="+a_lImageId,"viewImage","resizable=yes,scrollbars=no,toolbar=no,width=500,height=500");mywindow.focus();if(mywindow.opener==null){mywindow.opener=self}}function popupViewImage(a_lImageId,imageWidth,imageHeight,hasMultipleLayers){var screenWidth=imageWidth;var screenHeight=imageHeight;var iSize=imageWidth;if(imageHeight>imageWidth){iSize=imageHeight}if(screenWidth>1035){screenWidth=1035}if(screenHeight>700){screenHeight=700}else{if(hasMultipleLayers){screenHeight+=60}}var sUrl="../action/viewFullSizedImage?id="+a_lImageId+"&size="+iSize;if(hasMultipleLayers){sUrl+="&layer=1"}mywindow=open(sUrl,"viewImage","resizable=yes,scrollbars=yes,toolbar=no,width="+screenWidth+",height="+screenHeight);mywindow.focus();if(mywindow.opener==null){mywindow.opener=self}}function popupConditions(a_sAction){return(popupConditions(a_sAction,"false"))}function popupConditions(a_sAction,a_sExtra){mywindow=open("../action/"+a_sAction+"?extra="+a_sExtra,"viewConditions","resizable=yes,scrollbars=yes,toolbar=no,width=500,height=500");mywindow.location.href=a_sAction+"?extra="+a_sExtra;mywindow.focus();if(mywindow.opener==null){mywindow.opener=self}}function videoPopup(a_sURL){mywindow=open(a_sURL,"myname","toolbar=no,location=no,resizable=yes,scrollbars=yes,width=558,height=400");mywindow.location.href=a_sURL;mywindow.focus();if(mywindow.opener==null){mywindow.opener=self}}function audioPopup(a_sURL){mywindow=open(a_sURL,"myname","toolbar=no,location=no,resizable=yes,scrollbars=yes,width=420,height=200");mywindow.location.href=a_sURL;mywindow.focus();if(mywindow.opener==null){mywindow.opener=self}}function popupPreview(a_sURL,a_iWidth,a_iHeight){if(a_iWidth<=0){a_iWidth=800}if(a_iHeight<=0){a_iHeight=600}mywindow=open(a_sURL,"myname","toolbar=no,location=no,resizable=yes,scrollbars=yes,width="+(a_iWidth+50)+",height="+(a_iHeight+80));mywindow.location.href=a_sURL;mywindow.focus();if(mywindow.opener==null){mywindow.opener=self}}function expand_content(item){if(document.getElementById&&document.getElementsByTagName){if(document.getElementById(item)){var check=document.getElementById(item);document.getElementById("expandLink").style.display="none";document.getElementById("collapseLink").style.display="block";check.style.display="block";return false}}}function collapse_content(item){if(document.getElementById&&document.getElementsByTagName){if(document.getElementById(item)){var check=document.getElementById(item);document.getElementById("expandLink").style.display="block";check.style.display="none";return false}}}function showHide(id,imgId){var element=document.getElementById(id);var image=document.getElementById(imgId);if(element){if(element.style.display!="block"){element.style.display="block";image.src="../images/standard/icon/attr_collapse.gif"}else{element.style.display="none";image.src="../images/standard/icon/attr_expand.gif"}}}var lbPanel={config:{container:"#lightbox",hasThumbScroll:false},init:function(settings){$j.extend(lbPanel.config,settings);lbPanel.$container=$j(lbPanel.config.container);lbPanel.$drop=lbPanel.$container.find(".js-dropdown-multiple-lightboxes");lbPanel.$drop.find(".js-lightbox-add-button").click(function(e){$thisInput=$j(this);var $textInput=$thisInput.prev("input");if($textInput.val()==""){alert("Please enter a value for the new lightbox name.");$textInput.blur();return false}else{lbPanel.addLightbox($thisInput);$textInput.val("").focus()}});lbPanel.$drop.find("input.text").on("keyup",function(event){if(event.keyCode==13){$j(this).next("input").click()}});lbPanel.$container.find("a.empty").click(function(e){e.preventDefault();lbPanel.emptyLightbox($j(this))});lbPanel.listenForAddedAssets();lbPanel.listenForRemovedAssets();if(lbPanel.config.hasThumbScroll){lbPanel.$container.on("click","a.remove-item",function(e){e.preventDefault();lbPanel.removeSingleItem($j(this))})}},listenForAddedAssets:function(){$(document).on("assetAddedToLightbox",function(e){lbPanel.incrementCounts(1);if(lbPanel.config.hasThumbScroll){var $newThumb=$j(e.htmlReturnedByServer);lbPanel.addThumbnailToStrip($newThumb);lbPanel.noLongerEmpty()}})},listenForRemovedAssets:function(){$(document).on("assetRemovedFromLightbox",function(e){lbPanel.incrementCounts(-1);if(lbPanel.config.hasThumbScroll){var $liToBeRemoved=lbPanel.$container.find("#assetStripAsset"+e.assetId);$liToBeRemoved.fadeOut("fast",function(){$liToBeRemoved.remove()})}})},addLightbox:function($addButton){var newName=$addButton.siblings("input").val();var $addLi=$addButton.parent();var $newLi=$j('<li><a class="option option--loading"><span class="option__radio"></span><span class="option__name">'+newName+'</span><span class="option__meta">0</span></a></li>');var $parentUl=lbPanel.$drop.find("ul");$newLi.appendTo(lbPanel.$drop.find("ul"));clogger.send("CreateLightbox","LightboxPanel");var scrollUl=lbPanel.$drop.find("ul").get(0);scrollUl.scrollTop=scrollUl.scrollHeight;var myUrl="../action/addAssetBox";var myData={"CSRF":csrfToken,"ajax":true,"name":newName};$j.ajax({type:"POST",url:myUrl,data:myData,success:function(data,textStatus,xhr){$newLi.html('<li><a class="option" href="../action/switchAssetBox?currentAssetBoxId='+data.lbID+"&CSRF="+window.csrfToken+'"><span class="option__radio"></span><span class="option__name">'+data.lbName+'</span> <span class="option__meta">0</span></a></li>').effect("highlight",{},1500)},dataType:"json",error:function(XMLHttpRequest,textStatus,errorThrown){alert(textStatus);$newLi.remove()}})},emptyLightbox:function($emptyLink){var response=confirm(emptyLightboxConfirmation);if(response==true){var myUrl=$emptyLink.attr("href");$j.ajax({url:myUrl,success:function(data){lbPanel.resetCounts();lbPanel.resetAddLinks();lbPanel.hideEmptyLink();if(lbPanel.config.hasThumbScroll){lbPanel.removeAllFromStrip();lbPanel.isNowEmpty()}},error:function(XMLHttpRequest,textStatus,errorThrown){alert("Error: "+textStatus)}})}},removeSingleItem:function($thisLink){var assetId=$thisLink.data("asset-id");var $matchingRemoveLink=$j("#ajaxRemoveFromLightbox"+assetId);if($matchingRemoveLink.length){clogger.send("RemoveFromLightboxStrip","ClickedMatchingRemoveLink");$matchingRemoveLink.click()}else{clogger.send("RemoveFromLightboxStrip","UpdatedServerDirectly");var url=$thisLink.attr("href")+"&type=Ajax",$parentLi=$thisLink.parent("li"),removeFromLightboxRequest;removeFromLightboxRequest=lbAddRemove.updateTheServer(url);removeFromLightboxRequest.done(function(){lbPanel.incrementCounts(-1);$parentLi.fadeOut("fast",function(){$parentLi.remove()})})}},addThumbnailToStrip:function($newThumbHTML){var $thumbStrip=lbPanel.$container.find(".thumbScroll");$newThumbHTML.appendTo($thumbStrip);$newThumbHTML.find("img").on("load",function(){lbPanel.scrollToEndOfStrip();$j(document).trigger("imageAddedToLightboxStrip")})},scrollToEndOfStrip:function(){var $scrollingThumbsWrap=lbPanel.$container.find(".thumbScroll-wrap");var distanceToEnd=$scrollingThumbsWrap.find(".thumbScroll").width();$scrollingThumbsWrap.scrollLeft(distanceToEnd)},resetAddLinks:function(){$(document).trigger("lightboxEmptied")},noLongerEmpty:function(){lbPanel.$container.find(".lbStrip-empty").hide();lbPanel.$container.find(".thumbScroll").show()},isNowEmpty:function(){lbPanel.$container.find(".lbStrip-empty").show();lbPanel.$container.find(".thumbScroll").hide()},removeAllFromStrip:function(){var $everyLi=lbPanel.$container.find(".thumbScroll li");$everyLi.fadeOut("fast",function(){$everyLi.remove()})},showEmptyLink:function(){lbPanel.$container.find("a.empty").addClass("on")},hideEmptyLink:function(){lbPanel.$container.find("a.empty").removeClass("on")},incrementCounts:function(intIncrement){var currentCount=parseInt(lbPanel.$container.find(".navpanel--lightbox__contents .numItems").text());var newCount=currentCount+parseInt(intIncrement);if(newCount==1){document.getElementById("itemsInLightbox").innerHTML=document.getElementById("itemInLightBoxText").innerHTML;lbPanel.showEmptyLink();lbPanel.noLongerEmpty()}else{document.getElementById("itemsInLightbox").innerHTML=document.getElementById("itemsInLightBoxText").innerHTML}if(newCount===0){lbPanel.isNowEmpty();lbPanel.hideEmptyLink()}var $count1=lbPanel.$container.find("li.js-current-lightbox span.option__meta");var $count2=lbPanel.$container.find(".navpanel--lightbox__contents .numItems").eq(0);$count1.text(newCount);$count2.text(newCount)},resetCounts:function(){var $counts=lbPanel.$container.find(".navpanel--lightbox__contents .numItems");$counts.add("li.js-current-lightbox span.option__meta").text("0")}};function moveAssetInLightbox(assetId,assetIdInfrontOf,last){var divId=0;var url="moveAssetInAssetBox?id="+assetId+"&moveTo="+assetIdInfrontOf+"&CSRF="+window.csrfToken;$j.get(url,function(data){$j(divId).html(data)})}function ajaxUpdate(url,match_text,url2,optionalDelay){$j.get(url,function(data){$j("#ajaxUpdateContent").html(data);if(data.indexOf(match_text)>=0){window.location=url2}else{if(optionalDelay){window.setTimeout(function(){ajaxUpdate(url,match_text,url2,optionalDelay)},optionalDelay)}}})}function preventTimeout(){$j.ajax({url:"refreshSession",success:function(){setTimeout(preventTimeout,300000)}})}function splitString(val,delim){return val.split(delim)}function extractLast(term,delim){return splitString(term,delim).pop()}function initJQAutocompleter($input,delimiters,attrId,searchEdit,langCode){var delimSet=true;var delim="";if(typeof delimiters=="undefined"||delimiters==""){var delimSet=false}else{delim=delimiters[0]}if(typeof attrId=="undefined"){attrId=""}if(typeof searchEdit=="undefined"){searchEdit="search"}if(typeof langCode=="undefined"){langCode=""}var autocompleteOptions={source:function(request,response){var term=request.term;if(delimSet){term=extractLast(term,delim)}$j.ajax({url:"../action/autoComplete",dataType:"json",type:"POST",html:true,data:{prefix:term,attributeId:attrId,completeType:searchEdit,languageCode:langCode},success:function(data,textStatus,jqXHR){var newTerm=$input.val();if(delimSet){newTerm=extractLast(newTerm,delim)}if(term==newTerm){response(data)}}})},minLength:2,focus:function(){return false},select:function(event,ui){if(delimSet){var terms=splitString(this.value,delim);terms.pop();terms.push(ui.item.value);terms.push("");this.value=terms.join(delim);return false}else{this.value=ui.item.value}$("body").trigger("autocomplete-selected")}};if(delimSet){autocompleteOptions.search=function(){var term=extractLast(this.value,delim);if(term.length<2){return false}}}$input.on("keydown",function(event){if($(this).data("autocomplete")!==undefined){if((event.keyCode===$j.ui.keyCode.TAB)&&($(this).data("autocomplete").menu.active)&&delimSet){event.preventDefault()}}}).autocomplete(autocompleteOptions).autocomplete("instance")._renderItem=function(ul,item){return $j("<li></li>").data("item.autocomplete",item).append("<a>"+item.label+"</a>").appendTo(ul)}}(function($){var proto=$.ui.autocomplete.prototype,initSource=proto._initSource;function filter(array,term){var matcher=new RegExp($.ui.autocomplete.escapeRegex(term),"i");return $.grep(array,function(value){return matcher.test($("<div>").html(value.label||value.value||value).text())})}$.extend(proto,{_initSource:function(){if(this.options.html&&$.isArray(this.options.source)){this.source=function(request,response){response(filter(this.options.source,request.term))}}else{initSource.call(this)}},_renderItem:function(ul,item){return $("<li></li>").data("item.autocomplete",item).append($("<a></a>")[this.options.html?"html":"text"](item.label)).appendTo(ul)}})})(jQuery);function equalHeights($elements,options){var tallest=0;$elements.each(function(){var thisHeight="";if(options=="totalHeight"){thisHeight=$j(this).height()}else{thisHeight=$j(this).innerHeight()}if(thisHeight>tallest){tallest=thisHeight}});$elements.each(function(){$j(this).height(tallest)})}function initDatePicker(options){setDateFormat=jqDateFormats.standard;datePickerSettings={showOn:"both",buttonImage:"../images/standard/icon/icon_date.svg",buttonImageOnly:true,dateFormat:jqDateFormats.standard,beforeShow:function(input){$j("#ui-datepicker-div").removeClass("noDays")}};if(typeof options!="undefined"){if(options.hasOwnProperty("lowerLimit")){datePickerSettings["minDate"]=options.lowerLimit}if(options.hasOwnProperty("upperLimit")){datePickerSettings["maxDate"]=options.upperLimit;datePickerSettings["constrainInput"]=true}}$j(".js-datePicker").datepicker(datePickerSettings);var dateTimeSettings=$j.extend({},datePickerSettings,{constrainInput:false});$j(".js-datetimePicker").datepicker(dateTimeSettings);$j(".js-monthPicker").datepicker({showOn:"button",buttonImage:"../images/standard/icon/icon_date.svg",buttonImageOnly:true,changeMonth:true,changeYear:true,showButtonPanel:true,dateFormat:jqDateFormats.yearMonth,yearRange:"1900:2100",beforeShow:function(input,inst){var $this=$j(this);if((datestr=$this.val()).length>0){var parsedDate=Date.parse(datestr);$this.datepicker("option","defaultDate",parsedDate);$this.datepicker("setDate",parsedDate)}$j("#ui-datepicker-div").addClass("noDays")},onClose:function(dateText,inst){var month=$j("#ui-datepicker-div .ui-datepicker-month :selected").val();var year=$j("#ui-datepicker-div .ui-datepicker-year :selected").val();$j(this).datepicker("setDate",new Date(year,month,1))}})}var toggleContent={init:function(showCallback,hideCallback){$j(".js-toggleContent").click(function(){var $toggleLink=$j(this),$toggleContent=$j("#"+$toggleLink.data("toggle-content"));if($toggleContent.is(":visible")){toggleContent.hideContent($toggleContent);toggleContent.updateLinkState(false,$toggleLink);if(hideCallback&&typeof (hideCallback)==="function"){hideCallback()}}else{toggleContent.showContent($toggleContent);toggleContent.updateLinkState(true,$toggleLink);if(showCallback&&typeof (showCallback)==="function"){showCallback()}}return false})},showContent:function($toggleContent){$toggleContent.slideDown("fast")},hideContent:function($toggleContent){$toggleContent.slideUp("fast")},updateLinkState:function(wasJustOpened,$toggleLink){wasJustOpened?$toggleLink.addClass("is-open"):$toggleLink.removeClass("is-open")}};function switchTab(element){$j(element).parent().addClass("is-active");$j(element).parent().siblings().removeClass("is-active")}function selectCheckboxes(strAllOrNone,cssSelector){var $checkBoxArray=$j(cssSelector);if(strAllOrNone=="all"){$checkBoxArray.attr("checked",true)}else{if(strAllOrNone=="none"){$checkBoxArray.removeAttr("checked")}}}function toggleState(thisCheckbox){if(thisCheckbox.checked==true){thisCheckbox.checked=false}else{thisCheckbox.checked=true}}function toggleClass(wrappingLi,force){if(wrappingLi.hasClassName("selected")){wrappingLi.removeClassName("selected")}else{wrappingLi.addClassName("selected")}}function toggleControls($elementToToggle,$togglingLink){$elementToToggle.toggle();$togglingLink.toggleClass("collapse")}function selectItems(b_trueOrFalse,containerId){var $checkBoxArray=$j("#"+containerId+" input:checkbox");$checkBoxArray.prop("checked",b_trueOrFalse);if(b_trueOrFalse){$j("#"+containerId+" li").addClass("selected is-selected")}else{$j("#"+containerId+" li").removeClass("selected is-selected")}}function popupMap(element){var mapWindow=window.open(element.href,"mapWindow","width=700,height=610,toolbar=no,location=no,status=no,menubar=no,resizable=yes,scrollbars=yes,titlebar=no");mapWindow.focus()}function getSpatialCoords($container){sLat=$j("input.sLat",$container).val();wLng=$j("input.wLng",$container).val();nLat=$j("input.nLat",$container).val();eLng=$j("input.eLng",$container).val()}function setSpatialCoords($container){$j(".sLat",$container).val(sLat).change();$j(".wLng",$container).val(wLng);$j(".nLat",$container).val(nLat);$j(".eLng",$container).val(eLng)}function popupMapInit(){$j(".js-map-popup").click(function(){$whichAttribute=$j(this).parents(".js-spatialSearch").eq(0);getSpatialCoords($whichAttribute);popupMap(this);return false})}function viewMapPopupInit(){$j(".js-map-popup").click(function(){$whichAttribute=$j(this).parents("td.padded").eq(0);sLat=$j("span.sLat",$whichAttribute).text();wLng=$j("span.wLng",$whichAttribute).text();nLat=$j("span.nLat",$whichAttribute).text();eLng=$j("span.eLng",$whichAttribute).text();popupMap(this);return false})}function searchMapPopupInit(){popupMapInit();$j(".areaPointToggle input").click(function(){activateSearchTab($j(this))});$j(".areaPointToggle input:checked").each(function(){activateSearchTab($j(this))})}function activateSearchTab($this){var $container=$this.parents(".js-spatialAreaWrap");var $label=$this.parent();$container.find(".areaPointToggle label").parent().removeClass("is-active");$this.parent().parent().addClass("is-active");$container.find(".js-searchArea").hide();$container.find(".js-searchPoint").hide();$container.find(".js-"+$label.attr("rel")).show()}var formUtil={checkboxToggle:function($checkbox,$content){if($checkbox.prop("checked")){$content.show()}else{$content.hide()}},toggleSelectAll:function(bool,$container){$container.find("input:checkbox").attr("checked",bool)},capsWarning:function(warningMessage){$j(".js-caps-check").after($j('<p class="help-block js-caps-warn" style="display: none;"><i class="icon-warning-sign"></i> '+warningMessage+"</p>"));$j(".js-caps-check").keypress(function(e){var s=String.fromCharCode(e.which),$this=$j(this);if(s.toUpperCase()===s&&s.toLowerCase()!==s&&!e.shiftKey){$this.next(".js-caps-warn").slideDown()}else{$j(".js-caps-warn").slideUp()}})}};function clearCmsMode(){$j.ajax({url:"clearCmsMode",data:"CSRF="+window.csrfToken})}var disableRightClick={init:function(clickMessage,tags){var $tags=tags;$tags.on("contextmenu",function(e){alert(clickMessage);e.preventDefault()})}};var autoScrollLog={init:function(tag){var $log=tag;if($log.length){$log.scrollTop($log[0].scrollHeight)}}};var clickableTableRows={init:function(){$j(".js-clickable-row tbody tr").click(function(){var url=$j(this).attr("data-url");if(url!=""){window.document.location=url}})}};$j(function(){popup.init();$j("#main_nav a.expanding").click(function(){var $link=$j(this);var $submenu=$link.next("ul");$submenu.toggle();$link.toggleClass("open");return false});if($j("#assetForm").length){var $listArray=$j("#assetForm .js-panel");var $checkArray=$j('#assetForm .js-panel input[type="checkbox"], #assetForm .js-panel input[type="radio"]');$checkArray.click(function(event){var $parentUL=$j(this).parents(".js-lightbox");var mode=$parentUL.attr("rel");event.stopPropagation();if(mode=="radio"){$j(this).parents(".js-lightbox").find(".js-panel").removeClass("is-selected")}$j(this).parents(".js-panel").toggleClass("is-selected")});$j("#assetForm input:checked").each(function(){$j(this).parents("li:eq(0)").addClass("is-selected")})}if($j("#lightbox").length){if($j("#lightbox").hasClass("lbStrip")){lbPanel.init({hasThumbScroll:true})}else{lbPanel.init()}}$j("#mainCol").on("click",".msg__dismiss",function(){$j.ajax({url:$(this).attr("href"),type:"GET"});$j(this).parent(".msg--notify").slideUp("fast");return false});clickableTableRows.init();responsiveTabs.init();dropdown.init();if($(".js-hover-preview").length){assetPreview.init()}lbAddRemove.init();finput.init()});$j(window).on("load",function(){if($j(".panel__list").length&&!Modernizr.flexbox){equalHeights($j(".panel"))}if($j(".catThumbs-portrait .catThumb-link").length){equalHeights($j(".catThumbs-portrait .catThumb-link .catThumb-text"),"totalHeight")}});function findItemWithIdInLists(lists,id){var foundItem;lists.find(function(list){var item=findItemWithIdInList(list,id);if(item){foundItem=item;return true}return false});return foundItem}function findItemWithIdInList(list,id){return list.find(function(item){return item.id===id})}function removeItemWithIdFromList(list,id){return list.filter(function(item){return item.id!==id})}var clogger;clogger=(function(){var loggingUrl="../js/clogger.txt";function send(action,source){var paramsToSend={"cloggerAction":action};if(typeof source!=="undefined"){paramsToSend.cloggerSource=source}$.ajax({url:loggingUrl,data:paramsToSend})}return{send:send}}());var navTooltips;navTooltips=(function(){var tooltipInstances;function init(isInitiallyOpen,languageDirection){$(".js-nev-toggle").on("click",function(event){clickToggle.handleButtonClick(event,function(isOpen){toggleTooltips(isOpen)})});tooltipInstances=tippy(".nev__link[data-tippy-content]",{placement:languageDirection==="rtl"?"left":"right",arrow:true,appendTo:document.body,flip:false,boundary:document.body,distance:16});toggleTooltips(isInitiallyOpen)}function toggleTooltips(isOpen){if(tooltipInstances){if(isOpen){disableTooltips();clickToggle.toggleButtonOn($(".js-nev-toggle"))}else{enableTooltips();clickToggle.toggleButtonOff($(".js-nev-toggle"))}}}function enableTooltips(){tooltipInstances.forEach(function(instance){instance.enable()})}function disableTooltips(){tooltipInstances.forEach(function(instance){instance.disable()})}return{init:init}}());var brightModal;brightModal=(function(){var $modalTriggers,$savedModalTrigger;function init(){$modalTriggers=$(".js-bright-modal-trigger");$modalTriggers.click(function(event){event.preventDefault();openModal($(this).attr("href"),$(this).data("target"),$(this))})}function openModal(contentUrl,modalTarget,$modalTrigger,optionalCallback){var $modal=$(modalTarget);renderDarkBackground($modal);$savedModalTrigger=$($modalTrigger);$("body").addClass("modal-is-open");$modal.addClass("modal-show");if(contentUrl!=="#"){setModalToLoadingState($(modalTarget));loadModalContent(contentUrl,$modal,optionalCallback)}$modal.find(".js-modal-close").focus();listenForExits(modalTarget)}function closeModal(modalTarget){var $modal=$(modalTarget);$("body").removeClass("modal-is-open");$modal.removeClass("modal-show");$(".modal-backdrop").remove();$modal.attr("style","");handleReturningKeyboardFocus()}function handleReturningKeyboardFocus(){$savedModalTrigger.focus()}function renderDarkBackground($modal){$modal.prepend('<div class="modal-backdrop" data-dismiss="modal"></div>')}function loadModalContent(url,$modal,optionalCallback){getModalContentElement($modal).load(url,function(response,status,xhr){if(status==="error"){var msg="Error: ";getModalContentElement($modal).find(".modal-body").html('<div class="msg-error">'+msg+xhr.status+" "+xhr.statusText+"</div>")}else{if(optionalCallback){optionalCallback()}}$modal.find(".js-modal-close").focus()})}function listenForExits(modalTarget){$("body").on("click",'[data-dismiss="modal"]',function(event){event.preventDefault();closeModal(modalTarget)});$(document).on("keyup",function(event){if(event.keyCode===27){closeModal(modalTarget)}})}function changeModalSize($modal,size){if($modal.length&&size){removeSizeClasses($modal);$modal.addClass("modal--"+size)}}function setModalToLoadingState($modal){var $modalLoading='<div class="modal-body"><div class="modal-loading"><div class="load-spinner"></div><span class="modal-loading__text">Loading...</span></div></div>';$modal.find(".modal-content").html($modalLoading)}function getModalContentElement($modal){return $modal.find(".modal-content")}function removeSizeClasses($modal){$modal.removeClass("modal--small modal--medium modal--large")}return{init:init,openModal:openModal,closeModal:closeModal,changeModalSize:changeModalSize,loadModalContent:loadModalContent}}());var responsiveNav;responsiveNav=(function(){var $navigationButton,$navigationContainer,$searchButton,$searchField,$searchContainer,$pageBody;function init(){$navigationButton=$(".js-responsive-menu");$navigationContainer=$("#navCol");$searchButton=$(".js-responsive-search");$searchField=$(".js-keywords");$searchContainer=$(".js-search-wrapper");$pageBody=$("body");$navigationButton.click(function(event){closeSearch();toggleNav();stopPropagation(event)});$searchButton.click(function(event){closeNav();toggleSearch();$searchField.focus();stopPropagation(event)});$navigationContainer.click(function(event){stopPropagation(event)});$searchContainer.click(function(event){stopPropagation(event)});$pageBody.click(function(){closeOpenPanelsCheck()});$(window).on("orientationchange",function(){resetNavContainerHeight()})}function toggleNav(){$navigationContainer.toggleClass("is-open")}function closeNav(){$navigationContainer.removeClass("is-open")}function toggleSearch(){$pageBody.toggleClass("search-open")}function closeSearch(){$pageBody.removeClass("search-open")}function resetNavContainerHeight(){var bodyHeight=$pageBody.height(),bodyWidth=$pageBody.width(),desktopView=1024;if(bodyWidth>=desktopView){$navigationContainer.height("auto")}else{$navigationContainer.height(bodyHeight)}}function stopPropagation(event){event.stopPropagation()}function closeOpenPanelsCheck(){if($navigationContainer.hasClass("is-open")){toggleNav()}if($pageBody.hasClass("search-open")){toggleSearch()}}return{init:init}}());var responsiveTabs;responsiveTabs=(function(){var $tabs;function init(){$tabs=$(".tabs");handleClicks()}function handleClicks(){$tabs.on("click","a",function(event){var $thisLink=$(event.currentTarget),$thisLi=$thisLink.parent("li"),$thisTabs=$thisLink.closest(".tabs"),linkTarget=$thisLink.attr("href");if($thisLi.hasClass("is-active")){toggleTabDropdown($thisTabs);if(areTabsCollapsed($thisLi)){event.preventDefault()}}else{if(linkTarget.indexOf("#")===0){switchTabs($thisLi,linkTarget);event.preventDefault()}else{}}});$tabs.on("click",".is-active > label",function(event){var $thisTabs=$(event.currentTarget).closest(".tabs");toggleTabDropdown($thisTabs);event.preventDefault()})}function switchTabs($thisLi,linkTarget){$thisLi.siblings().removeClass("is-active");$thisLi.addClass("is-active");$(linkTarget).show().siblings(".tabs__content").hide();closeTabHolder($thisLi.parent(".tabs"))}function toggleTabDropdown($element){if($element.hasClass("is-open")){closeTabHolder($element)}else{openTabHolder($element)}}function areTabsCollapsed($tab){return $tab.css("position")==="relative"}function openTabHolder($element){$element.addClass("is-open")}function closeTabHolder($element){$element.removeClass("is-open")}return{init:init}}());var dropdown;dropdown=(function(){var $allDropdownTriggers,$currentDropdown,autocompleteWasSelected,$pageBody;function init(){$pageBody=$("body");$allDropdownTriggers=$("[data-dropdown]");if($allDropdownTriggers.length>0){monitorTriggerElement();closeWhenClickedOut()}}function monitorTriggerElement(){$allDropdownTriggers.on("click",function(event){var $currentTrigger,$relatedDropdown;event.stopPropagation();event.preventDefault();$currentTrigger=$(this);$allDropdownTriggers.attr("data-dropdown-active","false");$currentTrigger.attr("data-dropdown-active","true");if($(this).hasClass("js-closest-dropdown")){$relatedDropdown=$(this).next($("."+$currentTrigger.attr("data-dropdown")))}else{$relatedDropdown=$("."+$currentTrigger.attr("data-dropdown"))}$relatedDropdown.on("click",function(event){event.stopPropagation()});$("body").on("autocomplete-selected",function(){autocompleteWasSelected=true});toggleDropdown($relatedDropdown)})}function closeWhenClickedOut(){$pageBody.click(function(event){if(wasNotClosingAModal(event.target)){if(notTargetingDatePicker(event)&&!dropdownHasAutocomplete()){closeAllDropdowns(true)}if(dropdownHasAutocomplete()&&!autocompleteWasSelected){closeAllDropdowns(true)}autocompleteWasSelected=false}})}function toggleDropdown($dropdown){$currentDropdown=$dropdown;if($dropdown.attr("data-dropdown-is-open")==="true"){closeDropdown($dropdown)}else{openDropdown($dropdown)}}function openDropdown($dropdown){closeAllDropdowns();$dropdown.show();$dropdown.attr("data-dropdown-is-open","true")}function closeDropdown($dropdown){$dropdown.hide();$dropdown.attr("data-dropdown-is-open","false")}function closeAllDropdowns(shouldDisableTriggers){$("[data-dropdown-active]").each(function(){var $thisDropdown=$("."+$(this).attr("data-dropdown"));closeDropdown($thisDropdown);if(shouldDisableTriggers){$(this).attr("data-dropdown-active","false")}})}function dropdownHasAutocomplete(){if($currentDropdown!==undefined){return $currentDropdown.find(".ui-autocomplete-input").length>0}}function notTargetingDatePicker(event){return !event.target.closest(".ui-corner-all")}function wasNotClosingAModal(target){return $(target).data("dismiss")!=="modal"}return{init:init,closeAllDropdowns:closeAllDropdowns}}());var assetModal;assetModal=(function(){var modalImgSrc,$modalTrigger,$modal,$modalImg,modalImg;function init(imgSrc,modalShouldBeOpenInitially){modalImgSrc=imgSrc;initDomReferences();removeModalPreload();initModalEventHandlers();if(modalShouldBeOpenInitially===true){openBrightModal()}}function removeModalPreload(){if($(".modal--preload").length>0){$modal.removeClass("modal--preload")}}function initDomReferences(){$modal=$("#imageModal");$modalTrigger=$(".js-asset-modal-trigger");$modalTrigger.addClass("is-ready");$modalImg=$modal.find(".js-modal-image")}function initModalEventHandlers(){$modalTrigger.on("click",function(){openBrightModal($(this))});$modal.on("click",'[data-dismiss="modal"]',function(){$modalImg.removeClass("fadeIn")})}function openBrightModal($modalTrigger){brightModal.openModal("#",$modal,$modalTrigger);prepareModalImage();clogger.send("LaunchAssetModal","AssetDetailPage")}function showModalImage(){$modal.find(".js-loading-text").hide();$modalImg.attr("src",modalImgSrc);$modalImg.addClass("fadeIn")}function prepareModalImage(){modalImg=new Image();modalImg.onload=function(){showModalImage()};modalImg.src=modalImgSrc}return{init:init}}());var inputNavigation;inputNavigation=(function(){var $swipeable,nextPageUrl,prevPageUrl,modalOpen,scrollDistance,excludedElements,screenSize;function init(){nextPageUrl=$(".js-nextPage").attr("href");prevPageUrl=$(".js-prevPage").attr("href");if(hasNextOrPrevUrl()===true){setupDomElements();setDeviceOptions();listenForKeyboardEvents();var swipeOptions={triggerOnTouchEnd:true,swipeStatus:listenForSwipeEvents,allowPageScroll:"vertical",threshold:scrollDistance,excludedElements:excludedElements,fallbackToMouseEvents:false};$swipeable.swipe(swipeOptions)}}function setupDomElements(){$("body").children().wrapAll('<div class="swipe__overlay js-swipe-wrapper"></div>');$(".js-swipe-arrows").insertAfter(".js-swipe-wrapper");$(".js-swipe-arrows").removeClass("hidden");$swipeable=$(".js-swipe-wrapper")}function setDeviceOptions(){excludedElements="input, a.button, .detail__preview a, textarea, select";screenSize=$(window).width();if(screenSize>767){scrollDistance=200}if(screenSize<=767){scrollDistance=150}if(screenSize<=400){scrollDistance=100}}function hasNextOrPrevUrl(){if(nextPageUrl===undefined&&prevPageUrl===undefined){return false}else{return true}}function isNavigationAllowed(){if(document.activeElement.tagName==="INPUT"||document.activeElement.tagName==="TEXTAREA"){return false}else{return true}}function isModalOpen(){return $(".modal").hasClass("modal-show")}function isZoomOpen(){return $(".viewer-container").hasClass("viewer-in")}function attachUrlParameters(url){url=url+"&modal=true";return url}function listenForKeyboardEvents(){$(document).on("keyup",function(e){modalOpen=isModalOpen()||isZoomOpen();if(isNavigationAllowed()===true){switch(e.which){case 37:if(prevPageUrl&&!e.metaKey){changePage(prevPageUrl)}break;case 39:if(nextPageUrl&&!e.metaKey){changePage(nextPageUrl)}break}}})}function listenForSwipeEvents(event,phase,direction,distance){if(phase==="move"&&(direction==="left"||direction==="right")){swipeStart();modalOpen=isModalOpen();if(direction==="left"&&nextPageUrl){scrollLeftCheck(distance)}if(direction==="right"&&prevPageUrl){scrollRightCheck(distance)}}if(phase==="cancel"){swipeEnd()}if(phase==="end"&&direction==="left"&&nextPageUrl){preloadTransistion();setTimeout(function(){changePage(nextPageUrl)},900)}if(phase==="end"&&direction==="right"&&prevPageUrl){preloadTransistion();setTimeout(function(){changePage(prevPageUrl)},900)}}function preloadTransistion(){$swipeable.removeAttr("style");$(".swipe__underlay").addClass("swipe__underlay--loading")}function changePage(url){if(modalOpen===true){url=attachUrlParameters(url)}location.replace(url)}function scrollLeftCheck(distance){if(distance<scrollDistance){distance=-distance;scrollPage(distance)}}function scrollRightCheck(distance){if(distance<scrollDistance){scrollPage(distance)}}function scrollPage(distance){if(distance===0){$swipeable.removeAttr("style")}else{$swipeable.css("transform","translate("+distance+"px, 0)")}}function swipeStart(){$("body").addClass("swipe--is-page-swiping")}function swipeEnd(){$("body").removeClass("swipe--is-page-swiping");scrollPage(0)}return{init:init,changePage:changePage,listenForSwipeEvents:listenForSwipeEvents}}());"use strict";function CategoryPicker($wrappingDiv){this.availableItemsArray=[];this.$picker=$wrappingDiv;this.$inputField=this.$picker.find(".js-picker-filter");this.$pickerAvailable=this.$picker.find(".picker-available");this.$pickerSelected=this.$picker.find(".picker-selected");this.$pickerCheckboxes=this.$picker.find(".js-picker-checkbox")}CategoryPicker.prototype={constructor:CategoryPicker,init:function(){this.hideElements();this.handleClicks();this.initAutoComplete();this.setInitialStates()},hideElements:function(){this.$picker.removeClass("picker--no-js")},handleClicks:function(){var self=this;self.$picker.find(".picker__toggle").on("click",function(event){event.preventDefault();self.toggleItems($(this).parent(".picker__item"))});self.$picker.on("click",".js-picker-checkbox",function(){var $parentLabel=$(this).parent("label");if($parentLabel.hasClass("is-added")){self.deselectItem($parentLabel)}else{self.selectItem($parentLabel)}});self.$picker.on("click",".picker__remove",function(){self.getMatchingCheckbox($(this).data("id")).trigger("click")})},initAutoComplete:function(){var self=this;self.availableItemsArray=self.getAvailableItems();self.$inputField.autocomplete({source:self.availableItemsArray,select:function(event,ui){event.preventDefault();self.getMatchingCheckbox(ui.item.id).trigger("click");self.$inputField.select()},focus:function(event){event.preventDefault()}}).data("ui-autocomplete")._renderItem=function(ul,item){return $("<li></li>").data("item.autocomplete",item).append("<a data-suggest-id="+item.id+">"+item.path+"<strong>"+item.value+"</strong></a>").appendTo(ul)};self.$inputField.on("keypress",function(event){if(event.which===13){event.preventDefault()}})},setInitialStates:function(){var self=this;self.$pickerCheckboxes.each(function(){var $thisCheckbox=$(this);if($thisCheckbox.is(":checked")){var $parentLabel=$thisCheckbox.parent("label");self.selectItem($parentLabel)}if($thisCheckbox.is(":disabled")){var $otherParentLabel=$thisCheckbox.parent("label");$otherParentLabel.addClass("is-disabled");self.removeFromAutocompleteSource($otherParentLabel)}})},toggleItems:function($topItem){if($topItem.hasClass("is-expanded")){this.collapse($topItem)}else{this.expand($topItem)}},expand:function($topItem){$topItem.addClass("is-expanded")},collapse:function($topItem){$topItem.removeClass("is-expanded")},selectItem:function($item){var itemDetails=this.getFullItemDetails($item);$item.addClass("is-added");var itemLi=$('<li class="picker__remove" data-id="'+itemDetails.id+'"></li>');itemLi.text(itemDetails.path+itemDetails.value);this.$pickerSelected.append(itemLi);this.removeFromAutocompleteSource($item)},deselectItem:function($item){var thisCatId=$item.data("id");var $itemToBeDeleted=this.$pickerSelected.find('[data-id="'+thisCatId+'"]');$item.removeClass("is-added");$itemToBeDeleted.addClass("is-deleted").one("animationend webkitAnimationEnd oAnimationEnd MSAnimationEnd",function(){$(this).remove()});if(!Modernizr.cssanimations){$itemToBeDeleted.remove()}this.addToAutocompleteSource($item)},getMatchingCheckbox:function(id){var $matchingLabel=this.$pickerAvailable.find('[data-id="'+id+'"]');return $matchingLabel.find("input:checkbox")},getFullItemDetails:function($item){var itemPath="",itemName=$item.text(),$itemLI=$item.closest("li"),$parentLIs=$itemLI.parentsUntil(this.$pickerAvailable,"li");if($parentLIs.length>0){$parentLIs.each(function(){itemPath=$(this).children("label").text()+" > "+itemPath})}return{path:itemPath,value:itemName,id:$item.data("id")}},getAvailableItems:function(){var list=[],$availableItems,self=this;$availableItems=self.$pickerAvailable.find(".picker__add").not(function(){var $thisElem=$(this);return $thisElem.hasClass("is-added")||$thisElem.hasClass("is-disabled")});$availableItems.each(function(){list.push(self.getFullItemDetails($(this)))});return list},addToAutocompleteSource:function($item){this.availableItemsArray.push(this.getFullItemDetails($item));this.updateAutocompleteSource()},removeFromAutocompleteSource:function($item){var id=$item.data("id"),i;for(i=0;i<this.availableItemsArray.length;i+=1){if(this.availableItemsArray[i].id===id){this.availableItemsArray.splice(i,1);break}}this.updateAutocompleteSource()},updateAutocompleteSource:function(){this.$inputField.autocomplete("option",{source:this.availableItemsArray})}};var popup;popup=(function(){function init(){$("body").on("click",".js-popup",function(e){popupGeneric(this);e.preventDefault()})}function popupGeneric(elm,href,windowRef){var options=$(elm).data("popup-options")||"width=1280,height=600,toolbar=yes,location=no,status=no,menubar=no,resizable=yes,scrollbars=yes,titlebar=no";var newWindow=window.open(href||elm.href,windowRef||"newWindow",options);if(newWindow.blur){newWindow.focus()}}return{init:init,popupGeneric:popupGeneric}}());var assetPreview;assetPreview=(function(){var $previewContainer=$('<div class="hoverPreviewContainer" title="Hide preview"><div class="hoverPreview"></div></div>'),$previewDiv=$previewContainer.find(".hoverPreview"),previewTimeoutID,popperPreview,delayBeforeShowingPreview=300;function init(){$("body").append($previewContainer);initPreviewEventHandlers()}function initPreviewEventHandlers(){$("body").on("mouseenter",".panel__img-wrap",registerPreviewRequest);$("body").on("mouseleave",".panel__thumb",deRegisterPreviewRequest);$previewContainer.on("mouseleave",deRegisterPreviewRequest)}function registerPreviewRequest(evt){var $elemBeingEntered,$elemBeingExited;evt.stopImmediatePropagation();$elemBeingEntered=$(evt.currentTarget);$elemBeingExited=$(evt.relatedTarget);if($elemBeingExited.data("assetId")===$elemBeingEntered.data("assetId")){return }previewTimeoutID=setTimeout(function(){if($elemBeingEntered.hasClass("js-hover-preview")){showPreview($elemBeingEntered)}},delayBeforeShowingPreview)}function deRegisterPreviewRequest(e){var $elemBeingEntered=$(e.relatedTarget);var $elemBeingExited=$(e.currentTarget);window.clearTimeout(previewTimeoutID);if(typeof lookForAssociatedAssetId($elemBeingEntered)==="undefined"){hidePreview()}if(lookForAssociatedAssetId($elemBeingEntered)!==lookForAssociatedAssetId($elemBeingExited)){hidePreview()}}function lookForAssociatedAssetId($elem){if($elem.closest("[data-asset-id]").length){return $elem.closest("[data-asset-id]").data("assetId")}else{if($elem.children("[data-asset-id]").length){return $elem.find("[data-asset-id]").data("assetId")}else{return undefined}}}function showPreview($thumb){var previewData=$thumb.data("preview");if(previewData.showHoverVideo){showPreviewVideo($thumb,previewData)}else{if(previewData.showHoverAudio){showPreviewAudio($thumb,previewData)}else{showPreviewImage($thumb,previewData)}}}function showPreviewImage($thumbBeingHoveredOver,previewData){var image=new Image();recordOriginalAssetID($(image),$thumbBeingHoveredOver.data("assetId"));$previewDiv.addClass("checkerboard");image.onload=function(){insertAndPositionPreview($thumbBeingHoveredOver,$(image),previewData.includeAttributes);$thumbBeingHoveredOver.trigger("previewImageVisible")};image.src=previewData.imageFile}function showPreviewVideo($thumbBeingHoveredOver,previewData){var assetId=$thumbBeingHoveredOver.data("assetId");getPreviewSrc(assetId).done(function(videoSrc){var previewVideo=document.createElement("video");previewVideo.autoplay=true;previewVideo.muted=true;previewVideo.controlsList="nodownload";previewVideo.controls=previewData.showVideoControls;previewVideo.addEventListener("loadeddata",function(){insertAndPositionPreview($thumbBeingHoveredOver,$(previewVideo),previewData.includeAttributes)});previewVideo.src=videoSrc;recordOriginalAssetID($(previewVideo),assetId)}).fail(function(){console.log("Failed to retrieve url of preview video")})}function showPreviewAudio($thumbBeingHoveredOver,previewData){var assetId=$thumbBeingHoveredOver.data("assetId");getPreviewSrc(assetId).done(function(audioSrc){var previewAudio=document.createElement("audio");previewAudio.autoplay=true;previewAudio.controls=true;previewAudio.controlsList="nodownload";previewAudio.src=audioSrc;previewAudio.addEventListener("loadeddata",function(){insertAndPositionPreview($thumbBeingHoveredOver,$(previewAudio),previewData.includeAttributes,true);$previewContainer.addClass("audio-preview")});recordOriginalAssetID($(previewAudio),assetId)}).fail(function(){console.log("Failed to retrieve url of audio preview")})}function getPreviewSrc(assetId){return $.get("../go/previewUrl?assetId="+assetId)}function recordOriginalAssetID($elem,assetId){$elem.attr("data-asset-id",assetId)}function insertAndPositionPreview($thumb,$preview,includeAttributes){$preview.on("click",hidePreview);if(includeAttributes==="true"){appendAttributesToPreviewImage($thumb)}$previewDiv.html($preview);$previewContainer.hide().fadeIn(200);popperPreview=new Popper($thumb,$previewContainer,{placement:"top"})}function appendAttributesToPreviewImage($thumb){var $matchingAttributesList=getMatchingAttributeList($thumb);if($matchingAttributesList.length){$previewContainer.append($matchingAttributesList.clone().removeClass("hidden"))}}function getMatchingAttributeList($thumb){return $("#previewAttributes_"+$thumb.data("assetId"))}function hidePreview(){$previewContainer.hide();$previewDiv.html("");$previewDiv.removeClass("checkerboard");$previewContainer.removeClass("audio-preview");$previewContainer.find(".previewAttributes").remove()}return{init:init,hidePreview:hidePreview,insertAndPositionPreview:insertAndPositionPreview}}());var lbAddRemove;lbAddRemove=(function(){var $lazyLoadLinks;var MINMUMDELAY=Modernizr.csstransforms3d?250:0;function init(){$lazyLoadLinks=$(".js-lightbox-lazy-link");lazyLoadLinks();$(".js-add-to-lightbox").on("click",function(evt){evt.preventDefault();addToLightbox(evt.currentTarget)});$(".js-remove-from-lightbox").on("click",function(evt){evt.preventDefault();removeFromLightbox(evt.currentTarget)});$(document).on("lightboxEmptied",function(){switchToAdd($(".js-add-remove"))})}function lazyLoadLinks(){$lazyLoadLinks.each(function(){$(this).removeClass("hidden");$(this).attr("href",$(this).data("href"))})}function addToLightbox(thisLink){var $addLink=$(thisLink),url=$addLink.attr("href")+"&type=Ajax",$container=$addLink.parents(".js-add-remove"),addToLightboxRequest,smallDelay;clogger.send("AddToLightbox",window.location.href);$container.addClass("is-loading");$(document).trigger("addToLightboxStarted");smallDelay=$.Deferred();setTimeout(function(){smallDelay.resolve()},MINMUMDELAY);addToLightboxRequest=updateTheServer(url);$.when(smallDelay,addToLightboxRequest).then(function(_,data){switchToRemove($container);var assetAddedToLightboxEvent=$.Event("assetAddedToLightbox");assetAddedToLightboxEvent.htmlReturnedByServer=data[0];$(document).trigger(assetAddedToLightboxEvent)})}function removeFromLightbox(thisLink){var $thisRemoveLink=$(thisLink),url=$thisRemoveLink.attr("href")+"&type=Ajax",$container=$thisRemoveLink.parents(".js-add-remove"),assetId=$thisRemoveLink.data("asset-id"),removeFromLightboxRequest,smallDelay;clogger.send("RemoveFromLightbox",window.location.href);$container.addClass("is-loading");smallDelay=$.Deferred();setTimeout(function(){smallDelay.resolve()},MINMUMDELAY);removeFromLightboxRequest=updateTheServer(url);$.when(smallDelay,removeFromLightboxRequest).then(function(){switchToAdd($container);var assetRemovedFromLightboxEvent=$.Event("assetRemovedFromLightbox");assetRemovedFromLightboxEvent.assetId=assetId;$(document).trigger(assetRemovedFromLightboxEvent)})}function updateTheServer(url){return $.ajax({url:url,type:"GET"})}function switchToAdd($container){$container.removeClass("is-loading is-added")}function switchToRemove($container){$container.removeClass("is-loading").addClass("is-added")}function addToLightboxSimple(assetId){var url="addToAssetBox?id="+assetId+"&type=Ajax&CSRF="+window.csrfToken,currentCount=lbPanel.$container.find(".navpanel--lightbox__contents .numItems").text(),addToLightboxSimpleRequest;addToLightboxSimpleRequest=updateTheServer(url);addToLightboxSimpleRequest.done(function(data){var nameIndex=data.indexOf("num-assets-in-box");var valueIndex=data.indexOf('value="',nameIndex)+7;var newCount=parseInt(data.slice(valueIndex,data.indexOf('"',valueIndex)),10);if(newCount!==currentCount){lbPanel.incrementCounts(1)}})}return{init:init,addToLightboxSimple:addToLightboxSimple,updateTheServer:updateTheServer}}());var filterAssets;filterAssets=(function(){var $filterForm,$filterField,$filterToggle,$filterResetToggle;function init(){$filterForm=$(".js-header-filter");$filterField=$(".js-filter-field");$filterToggle=$(".js-filter-toggle");$filterResetToggle=$(".js-filter-reset");$filterToggle.attr("data-element","js-header-filter");$filterField.change(function(){submitFilterForm()});$filterResetToggle.click(function(event){event.preventDefault();resetFilterForm()});$filterField.each(function(){if($(this).val()>0){$(this).addClass("filter__select--selected")}})}function submitFilterForm(){$filterForm.submit()}function resetFilterForm(){$filterField.each(function(){$(this).val(-1)});submitFilterForm()}return{init:init}}());var clickToggle;clickToggle=(function(){function init(){$(".js-click-toggle").on("click",handleButtonClick)}function handleButtonClick(event,callbackFunc){event.preventDefault();var $thisButton=$(event.currentTarget),$relatedElement=$("."+$thisButton.data("element")),rememberURL=$thisButton.data("remember-url"),extraParams=$thisButton.data("extra-params"),secondaryClass=$thisButton.data("secondary-class"),secondaryRelatedElement=$thisButton.data("secondary-element"),isOpen;if($thisButton.hasClass("is-on")){toggleButtonOff($thisButton);$relatedElement.removeClass("is-visible");isOpen=false;if(secondaryClass){$(secondaryRelatedElement).removeClass(secondaryClass)}}else{toggleButtonOn($thisButton);$relatedElement.addClass("is-visible");isOpen=true;if(secondaryClass){$(secondaryRelatedElement).addClass(secondaryClass)}}if(rememberURL){var newState="open="+isOpen.toString();performAjaxCall(rememberURL,extraParams?newState+extraParams:newState)}if(callbackFunc){callbackFunc(isOpen)}}function performAjaxCall(urlToCall,dataToSend){$.ajax({url:urlToCall,data:dataToSend+"&CSRF="+window.csrfToken,type:"POST"})}function toggleButtonOn($button){$button.addClass("is-on")}function toggleButtonOff($button){$button.removeClass("is-on")}return{toggleButtonOn:toggleButtonOn,toggleButtonOff:toggleButtonOff,handleButtonClick:handleButtonClick,init:init}}());var lightbox;lightbox=(function(){var $inputForNumberOfAssets,$mainLabelForNumberOfAssets,newLightBoxName,$newLightboxForm,$newLightboxNameInput,$secondaryLabelForNumberOfAssets,$listOfLightBoxes,$duplicateMessage,$viewToggle,listOfLightboxNames;function init(){$inputForNumberOfAssets=$(".js-lightbox-count");$mainLabelForNumberOfAssets=$(".js-lightbox-count-label");$secondaryLabelForNumberOfAssets=$(".js-current-lightbox .option__meta");newLightBoxName="";$newLightboxForm=$(".js-lightbox-add-form");$newLightboxNameInput=$(".js-lightbox-input");$listOfLightBoxes=$(".js-lightbox-list");$duplicateMessage=$(".js-lightbox-msg");$viewToggle=$(".js-lightbox-toggle-view");listOfLightboxNames=[];listenForAssetsAddedToLightbox();listenForAssetsBeingRemovedFromLightbox();listenForNewLightboxCreation();listenForViewToggle();formatDisplayOfNumberOfAssetsInLightbox();setListOfLightboxNames()}function listenForAssetsAddedToLightbox(){$(document).on("assetAddedToLightbox",function(){incrementNumberOfAssetsInLightbox()})}function listenForAssetsBeingRemovedFromLightbox(){$(document).on("assetRemovedFromLightbox",function(){decrementNumberOfAssetsInLightbox()})}function listenForNewLightboxCreation(){$newLightboxForm.on("submit",function(event){event.preventDefault();if(newLightBoxNameIsNotEmpty()){if(lightBoxNameIsExactDuplicate()){tellUserAboutDuplicate()}else{addNewLightBox()}}})}function listenForViewToggle(){$viewToggle.click(function(event){event.preventDefault();var toggleViewUrl=$(this).data("toggle-view-url");$.post(toggleViewUrl);location.reload()})}function incrementNumberOfAssetsInLightbox(){var numberOfAsssetsInLightboxPlusOne=getNumberOfAssetsInLightbox()+1;handleUpdateToLightboxCount(numberOfAsssetsInLightboxPlusOne)}function decrementNumberOfAssetsInLightbox(){var numberOfAsssetsInLightboxMinusOne=getNumberOfAssetsInLightbox()-1;handleUpdateToLightboxCount(numberOfAsssetsInLightboxMinusOne)}function handleUpdateToLightboxCount(newNumberOfAssetsInLightbox){$inputForNumberOfAssets.val(newNumberOfAssetsInLightbox);$secondaryLabelForNumberOfAssets.text(newNumberOfAssetsInLightbox);formatDisplayOfNumberOfAssetsInLightbox()}function addNewLightBox(){newLightBoxName=$newLightboxNameInput.val();addLightboxInLoadingState(newLightBoxName);var lightBoxUrl="../action/addAssetBox";var lightBoxData={"CSRF":window.csrfToken,"ajax":true,"name":newLightBoxName};$.ajax({type:"POST",url:lightBoxUrl,data:lightBoxData,success:function(data){activateNewLightbox(data);resetLightBoxNameInput()},dataType:"json",error:function(XMLHttpRequest,textStatus,errorThrown){console.error(XMLHttpRequest,textStatus,errorThrown);$(".js-new-lightbox").remove()}})}function addLightboxInLoadingState(newLightBoxName){var $placeholderLightbox=$('<li class="js-new-lightbox"><a class="js-lightbox-link option option--loading"><span class="option__radio"></span><span class="option__name js-lightbox-names">'+newLightBoxName+'</span><span class="option__meta">0</span></a></li>');$listOfLightBoxes.append($placeholderLightbox);$placeholderLightbox[0].scrollIntoView()}function activateNewLightbox(data){var $newLightboxRow=$(".js-new-lightbox");var $lightboxLink=$newLightboxRow.find(".js-lightbox-link");$lightboxLink.removeClass("option--loading");$lightboxLink.attr("href","../action/switchAssetBox?currentAssetBoxId="+data.lbID+"&CSRF="+window.csrfToken);highlightLightbox($newLightboxRow);$newLightboxRow.removeClass("js-new-lightbox")}function highlightLightbox($newLightboxRow){$newLightboxRow.addClass("lightbox-highlight");setTimeout(function(){$newLightboxRow.removeClass("lightbox-highlight")},700)}function formatDisplayOfNumberOfAssetsInLightbox(){var currentAssetsInLightbox=getNumberOfAssetsInLightbox();if(numberOfAssetsInLightboxOver3Digits()){var thousandsOfAssetsInLightbox=(currentAssetsInLightbox/1000).toFixed(1);$mainLabelForNumberOfAssets.addClass("is-above-thousand");$mainLabelForNumberOfAssets.text(thousandsOfAssetsInLightbox+"k")}else{$mainLabelForNumberOfAssets.text(currentAssetsInLightbox)}$mainLabelForNumberOfAssets.addClass("is-visible")}function tellUserAboutDuplicate(){$duplicateMessage.show();setTimeout(function(){$duplicateMessage.hide()},3000)}function getNumberOfAssetsInLightbox(){return parseInt($inputForNumberOfAssets.val(),10)}function newLightBoxNameIsNotEmpty(){return $newLightboxNameInput.val()!==""}function numberOfAssetsInLightboxOver3Digits(){return getNumberOfAssetsInLightbox()>=1000}function lightBoxNameIsExactDuplicate(){setListOfLightboxNames();var newLightBoxName=$newLightboxNameInput.val();var isLightBoxDuplicate=false;$(".js-lightbox-names").each(function(){if($(this).html()===newLightBoxName){isLightBoxDuplicate=true}});return isLightBoxDuplicate}function setListOfLightboxNames(){listOfLightboxNames=[];$(".js-lightbox-names").each(function(){listOfLightboxNames.push($(this).html())})}function resetLightBoxNameInput(){$newLightboxNameInput.val("")}return{init:init}}());var finput;finput=(function(){var $fileInput,fullFilePath,labelText;function init(){$fileInput=$(".js-finput");$fileInput.on("change",function(){handleFileInputChange($(this))});$fileInput.on("dragenter focus click",function(){$(this).addClass("has-focus")});$fileInput.on("dragleave blur drop",function(){$(this).removeClass("has-focus")})}function handleFileInputChange($thisFileInput){fullFilePath=$thisFileInput.val();var $finputContainer=$thisFileInput.parents(".js-finput-container");$finputContainer.find(".js-finput-label").text(stripFilePath(fullFilePath));$finputContainer.addClass("has-file")}function stripFilePath(fullFilePath){labelText=fullFilePath.substring((fullFilePath.indexOf("\\")>=0?fullFilePath.lastIndexOf("\\"):fullFilePath.lastIndexOf("/")));if(labelText.indexOf("\\")===0||labelText.indexOf("/")===0){labelText=labelText.substring(1);return labelText}}return{init:init}}());var autoFillOff;autoFillOff=(function(){var $autoFillOffField;function init(){$autoFillOffField=document.getElementsByClassName("js-auto-fill-off");if(navigator.userAgent.toLowerCase().indexOf("chrome")>-1){for(var i=0;i<$autoFillOffField.length;i+=1){$autoFillOffField[i].setAttribute("autocomplete","new-password")}}document.addEventListener("DOMContentLoaded",function(){for(var i=0;i<$autoFillOffField.length;i+=1){$autoFillOffField[i].setAttribute("autocomplete","off");$autoFillOffField[i].value=""}})}return{init:init}}());var notify;notify=(function(){var $notificationsContainer;function init(){$notificationsContainer=$(".js-notifications");handleNotificationDismiss()}function notifyConfirmMessage(message){notifyMessage("confirm",message)}function notifyErrorMessage(message){notifyMessage("error",message)}function notifyMessage(messageType,message){$notificationsContainer.append($.parseHTML('<div id="" class="msg--notify msg-'+messageType+'"><a href="#" class="msg__dismiss js-notify-close">&times;</a>'+message+"</div>",document,false));$(".js-notify-close").click(function(event){event.preventDefault();$(this).parent().remove()})}function show(){var $container=$(".js-notifications"),ajaxURL=$container.data("url")||"../go/userNotifications";if($container.length>0){$container.html("");$container.load(ajaxURL)}else{console.error("Error: Notify.js expects a containing div on the page.")}}function handleNotificationDismiss(){$(".js-notify-close").click(function(event){event.preventDefault();var returnUrl=$(this).data("return-url");if(returnUrlIsEmptyOrUndefined(returnUrl)){callDismissNotificationViaAjax($(this))}else{window.location.href=$(this).attr("href")}})}function callDismissNotificationViaAjax($closeTrigger){var ajaxUrl=$closeTrigger.attr("href");var $targetMessage=$closeTrigger.parent();$.ajax({url:ajaxUrl,type:"post",success:function(){$targetMessage.remove()},error:function(XMLHttpRequest,textStatus,errorThrown){console.error(XMLHttpRequest,textStatus,errorThrown)}})}function returnUrlIsEmptyOrUndefined(returnUrl){return returnUrl===""||returnUrl===undefined}function populateDismissUrls(){$(".js-notify-close").each(function(){var baseUrl=$(this).data("base-url");var returnUrl=$(this).data("return-url");var notifyId=$(this).data("notify-id");var csrf=$(this).data("csrf");var fullDismissUrl=baseUrl+"?id="+notifyId+"&returnUrl="+returnUrl+csrf;$(this).attr("href",fullDismissUrl)})}return{init:init,notifyConfirmMessage:notifyConfirmMessage,notifyMessage:notifyMessage,notifyErrorMessage:notifyErrorMessage,show:show,handleNotificationDismiss:handleNotificationDismiss,populateDismissUrls:populateDismissUrls}}());var outlineFocus;outlineFocus=(function(){function init(){$("body").mousedown(function(){if(shouldDisableFocusStyles()){disableFocusStyles()}});$("body").keyup(function(event){if(tabWasPressed(event.keyCode)){enableFocusStyles()}})}function tabWasPressed(keyPressed){return keyPressed===9}function shouldDisableFocusStyles(){return $("html").hasClass("not-using-mouse")}function enableFocusStyles(){$("html").addClass("not-using-mouse")}function disableFocusStyles(){$("html").removeClass("not-using-mouse")}return{init:init}}());var brightAnalytics;brightAnalytics=(function(){var $eventTrigger;function init(){if(analyticsIsEnabled()){$eventTrigger=$(".js-analytics-event-trigger");$eventTrigger.click(function(){var name=setEmptyIfUndefined($(this).data("analytics-name"));var category=setEmptyIfUndefined($(this).data("analytics-category"));var label=setEmptyIfUndefined($(this).data("analytics-label"));var value=setEmptyIfUndefined($(this).data("analytics-value"));logEvent(name,category,label,value)})}}function analyticsIsEnabled(){return $(".js-analytics-is-enabled").length}function setEmptyIfUndefined(dataValue){return dataValue===undefined?"(not set)":dataValue}function logEvent(name,category,label,value){console.log("Analytics event logged | Name: "+name+" | Category: "+category);var analyticsId=$(".js-analytics-is-enabled").data("brightAnalyticsId");gtag("event",name,{"event_category":category,"event_label":label,"value":value,"send_to":analyticsId})}return{init:init,logEvent:logEvent}}());